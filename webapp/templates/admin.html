<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üë®‚Äçüíº –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - Telegram Shop</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="admin">
    <div class="admin-container">
        <!-- –°–∞–π–¥–±–∞—Ä -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <div class="admin-logo">
                    <i class="fas fa-crown"></i>
                    <h2>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h2>
                </div>
                <div class="admin-user">
                    <i class="fas fa-user-circle"></i>
                    <span>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                </div>
            </div>

            <nav class="admin-nav">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                </a>
                <a href="#" class="nav-item" data-page="products">
                    <i class="fas fa-box"></i>
                    <span>–¢–æ–≤–∞—Ä—ã</span>
                </a>
                <a href="#" class="nav-item" data-page="orders">
                    <i class="fas fa-clipboard-list"></i>
                    <span>–ó–∞–∫–∞–∑—ã</span>
                </a>
                <a href="#" class="nav-item" data-page="add-product">
                    <i class="fas fa-plus-circle"></i>
                    <span>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</span>
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <button class="btn-logout" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </button>
            </div>
        </aside>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="admin-main">
            <!-- –•–µ–¥–µ—Ä -->
            <header class="admin-header">
                <div class="header-left">
                    <h1 id="pageTitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
                    <div class="last-updated">
                        <i class="fas fa-sync-alt"></i>
                        –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="lastUpdated">—Ç–æ–ª—å–∫–æ —á—Ç–æ</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="btn-refresh" id="refreshBtn">
                        <i class="fas fa-redo"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </header>

            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
            <div class="admin-content">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="page active" id="dashboard">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon revenue">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalRevenue">0 ‚ÇΩ</h3>
                                <p>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orders">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalOrders">0</h3>
                                <p>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon products">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalProducts">0</h3>
                                <p>–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon pending">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="pendingOrders">0</h3>
                                <p>–û–∂–∏–¥–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ -->
                <div class="page" id="products">
                    <div class="products-header">
                        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
                        <div class="products-actions">
                            <button class="btn btn-primary" id="addProductBtn">
                                <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                            </button>
                        </div>
                    </div>

                    <div class="products-table-container">
                        <table class="products-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–¶–µ–Ω–∞</th>
                                    <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 40px;">
                                        <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –ó–∞–∫–∞–∑—ã -->
                <div class="page" id="orders">
                    <div class="orders-header">
                        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h2>
                    </div>
                    <div class="orders-table-container">
                        <table class="orders-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–°—É–º–º–∞</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–∞—Ç–∞</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <tr>
                                    <td colspan="5" style="text-align: center; padding: 40px;">
                                        <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
                <div class="page" id="add-product">
                    <div class="add-product-header">
                        <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h2>
                    </div>

                    <form class="add-product-form" id="addProductForm">
                        <div class="form-section">
                            <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="productName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                                    <input type="text" id="productName" required>
                                </div>
                                <div class="form-group">
                                    <label for="productPrice">–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                                    <input type="number" id="productPrice" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="productStock">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ *</label>
                                    <input type="number" id="productStock" required>
                                </div>
                                <div class="form-group">
                                    <label for="productCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                    <select id="productCategory">
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                            <div class="form-group">
                                <label for="productDescription">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                                <textarea id="productDescription" rows="4"></textarea>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h3>
                            <div class="form-group">
                                <label for="productImageUrl">URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                                <input type="url" id="productImageUrl"
                                       placeholder="https://example.com/image.jpg"
                                       value="https://via.placeholder.com/300x200">
                                <div class="image-preview" id="imagePreview">
                                    <img src="https://via.placeholder.com/300x200" alt="–ü—Ä–µ–≤—å—é"
                                         style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                                    <p>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</p>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelAdd">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä
                            </button>
                        </div>
                    </form>
                </div>

                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                <div class="page" id="settings">
                    <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞</h2>
                    <p>–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // –ü–†–û–°–¢–û–ô –ò –†–ê–ë–û–ß–ò–ô –ö–û–î –ê–î–ú–ò–ù–ö–ò
        console.log('üöÄ –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');

        let currentPage = 'dashboard';
        let products = [];
        let orders = [];

        // ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==========
        function showPage(pageId) {
            console.log('üìÑ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É:', pageId);

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
                page.classList.remove('active');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.style.display = 'block';
                targetPage.classList.add('active');
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === pageId) {
                    item.classList.add('active');
                }
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const titles = {
                'dashboard': '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                'products': '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏',
                'orders': '–ó–∞–∫–∞–∑—ã',
                'add-product': '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä',
                'settings': '–ù–∞—Å—Ç—Ä–æ–π–∫–∏'
            };

            const titleElement = document.getElementById('pageTitle');
            if (titleElement && titles[pageId]) {
                titleElement.textContent = titles[pageId];
            }

            currentPage = pageId;

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            if (pageId === 'dashboard') loadStats();
            if (pageId === 'products') loadProducts();
            if (pageId === 'orders') loadOrders();
            if (pageId === 'add-product') loadCategoriesForForm();
        }

        // ========== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ==========
        async function loadStats() {
            try {
                console.log('üìä –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...');
                const response = await fetch('/api/admin/dashboard');
                const data = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—ã
                document.getElementById('totalRevenue').textContent = formatPrice(data.total_revenue || 0) + ' ‚ÇΩ';
                document.getElementById('totalOrders').textContent = data.total_orders || 0;
                document.getElementById('totalProducts').textContent = data.total_products || 0;
                document.getElementById('pendingOrders').textContent = data.pending_orders || 0;

                updateLastUpdated();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        async function loadProducts() {
            try {
                console.log('üõçÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...');
                const response = await fetch('/api/admin/products');
                products = await response.json();
                renderProducts();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error);
                products = [];
                renderProducts();
            }
        }

        function renderProducts() {
            const tbody = document.getElementById('productsTableBody');
            if (!tbody) return;

            if (products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            <i class="fas fa-box-open" style="font-size: 48px; color: #ddd;"></i>
                            <p style="margin-top: 15px;">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        </td>
                    </tr>
                `;
                return;
            }

            let html = '';
            products.forEach(product => {
                const stockClass = product.stock > 20 ? 'stock-high' : product.stock > 5 ? 'stock-medium' : 'stock-low';

                html += `
                    <tr>
                        <td>${product.id}</td>
                        <td>
                            <img src="${product.image_url || 'https://via.placeholder.com/60'}"
                                 alt="${product.name}"
                                 style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;"
                                 onerror="this.src='https://via.placeholder.com/60'">
                        </td>
                        <td>
                            <strong>${product.name}</strong><br>
                            <small style="color: #666;">${(product.description || '').substring(0, 60)}${product.description && product.description.length > 60 ? '...' : ''}</small>
                        </td>
                        <td><strong>${formatPrice(product.price)} ‚ÇΩ</strong></td>
                        <td>
                            <span class="stock-indicator ${stockClass}">
                                ${product.stock} —à—Ç.
                            </span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn-icon btn-edit" onclick="editProduct(${product.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-delete" onclick="deleteProduct(${product.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        async function loadOrders() {
            try {
                console.log('üìã –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...');
                const response = await fetch('/api/admin/orders');
                const data = await response.json();
                orders = Array.isArray(data) ? data : [];
                renderOrders();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
                orders = [];
                renderOrders();
            }
        }

        function renderOrders() {
            const tbody = document.getElementById('ordersTableBody');
            if (!tbody) return;

            if (orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px;">
                            <i class="fas fa-clipboard-list" style="font-size: 48px; color: #ddd;"></i>
                            <p style="margin-top: 15px;">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        </td>
                    </tr>
                `;
                return;
            }

            let html = '';
            orders.forEach(order => {
                const status = order.status || 'pending';
                const statusText = {
                    'pending': '–û–∂–∏–¥–∞–µ—Ç',
                    'processing': '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
                    'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω',
                    'cancelled': '–û—Ç–º–µ–Ω–µ–Ω'
                }[status] || status;

                html += `
                    <tr>
                        <td><strong>#${order.id}</strong></td>
                        <td>${order.username || `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${order.user_id}`}</td>
                        <td><strong>${formatPrice(order.total_price)} ‚ÇΩ</strong></td>
                        <td>${statusText}</td>
                        <td>${new Date(order.created_at).toLocaleDateString('ru-RU')}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        async function loadCategoriesForForm() {
            try {
                const response = await fetch('/api/categories');
                const categories = await response.json();

                const select = document.getElementById('productCategory');
                if (select && categories.length > 0) {
                    select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>' +
                        categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
            }
        }

        // ========== –î–û–ë–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê ==========
        async function addProduct(e) {
            if (e) e.preventDefault();

            console.log('‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞...');

            const name = document.getElementById('productName').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const category = document.getElementById('productCategory').value;
            const description = document.getElementById('productDescription').value.trim();
            const imageUrl = document.getElementById('productImageUrl').value.trim();

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!name || isNaN(price) || price <= 0 || isNaN(stock) || stock < 0) {
                showAlert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ', 'error');
                return;
            }

            const productData = {
                name: name,
                description: description,
                price: price,
                stock: stock,
                category: category,
                image_url: imageUrl || 'https://via.placeholder.com/300x200'
            };

            console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º:', productData);

            try {
                const response = await fetch('/api/admin/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                });

                const result = await response.json();
                console.log('üì• –û—Ç–≤–µ—Ç:', result);

                if (result.success) {
                    showAlert('‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');

                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('addProductForm').reset();
                    document.getElementById('productImageUrl').value = 'https://via.placeholder.com/300x200';
                    previewImage('https://via.placeholder.com/300x200');

                    // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ø–∏—Å–∫—É
                    showPage('products');
                } else {
                    showAlert('‚ùå –û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        }

        // ========== –£–î–ê–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê ==========
        async function deleteProduct(id) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä #${id}? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
                return;
            }

            console.log('üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ #' + id);

            try {
                const response = await fetch(`/api/admin/products?id=${id}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('‚úÖ –¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω!', 'success');
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã
                    loadProducts();
                } else {
                    showAlert('‚ùå –û—à–∏–±–∫–∞: ' + (result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
            }
        }

        function editProduct(id) {
            showAlert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ #' + id, 'info');
        }

        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function formatPrice(price) {
            return new Intl.NumberFormat('ru-RU').format(price || 0);
        }

        function updateLastUpdated() {
            const element = document.getElementById('lastUpdated');
            if (element) {
                const now = new Date();
                element.textContent = now.toLocaleTimeString('ru-RU');
            }
        }

        function previewImage(url) {
            const preview = document.getElementById('imagePreview');
            if (!preview) return;

            if (!url || url.trim() === '') {
                url = 'https://via.placeholder.com/300x200';
            }

            preview.innerHTML = `
                <img src="${url}" alt="–ü—Ä–µ–≤—å—é"
                     style="max-width: 100%; max-height: 200px; border-radius: 8px;"
                     onerror="this.onerror=null; this.src='https://via.placeholder.com/300x200'">
                <p>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</p>
            `;
        }

        function showAlert(message, type = 'info') {
            const colors = {
                'success': '#2ecc71',
                'error': '#e74c3c',
                'info': '#3498db',
                'warning': '#f39c12'
            };

            const alert = document.createElement('div');
            alert.textContent = message;
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 10px;
                background: ${colors[type] || '#3498db'};
                color: white;
                z-index: 10000;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                animation: alertSlideIn 0.3s ease;
                max-width: 400px;
            `;

            document.body.appendChild(alert);

            setTimeout(() => {
                alert.style.animation = 'alertSlideOut 0.3s ease';
                setTimeout(() => alert.remove(), 300);
            }, 3000);
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º...');

            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                });
            });

            // –ö–Ω–æ–ø–∫–∏
            document.getElementById('refreshBtn')?.addEventListener('click', () => {
                if (currentPage === 'dashboard') loadStats();
                if (currentPage === 'products') loadProducts();
                if (currentPage === 'orders') loadOrders();
                showAlert('üîÑ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è...', 'info');
            });

            document.getElementById('logoutBtn')?.addEventListener('click', () => {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                    window.location.href = '/';
                }
            });

            document.getElementById('addProductBtn')?.addEventListener('click', () => {
                showPage('add-product');
            });

            document.getElementById('cancelAdd')?.addEventListener('click', () => {
                showPage('products');
            });

            // –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
            document.getElementById('addProductForm')?.addEventListener('submit', addProduct);

            // –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            document.getElementById('productImageUrl')?.addEventListener('input', function(e) {
                previewImage(e.target.value);
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            showPage('dashboard');

            console.log('üöÄ –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –≥–æ—Ç–æ–≤–∞!');
        });

        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
        const style = document.createElement('style');
        style.textContent = `
            @keyframes alertSlideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes alertSlideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            .stock-indicator {
                padding: 4px 12px;
                border-radius: 12px;
                font-size: 12px;
            }
            .stock-high { background: #d4edda; color: #155724; }
            .stock-medium { background: #fff3cd; color: #856404; }
            .stock-low { background: #f8d7da; color: #721c24; }
            .btn-icon {
                width: 36px;
                height: 36px;
                border-radius: 8px;
                border: none;
                cursor: pointer;
                font-size: 14px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .btn-edit { background: #3498db; color: white; }
            .btn-delete { background: #e74c3c; color: white; }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>