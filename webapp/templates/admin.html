<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ панель - Telegram Shop</title>
    <!-- ИСПРАВЛЕНО: Правильная ссылка на CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="admin">
    <div class="admin-container">
        <!-- Сайдбар -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <div class="admin-logo">
                    <i class="fas fa-crown"></i>
                    <h2>Админ панель</h2>
                </div>
                <div class="admin-user">
                    <i class="fas fa-user-circle"></i>
                    <span>Администратор</span>
                </div>
            </div>

            <nav class="admin-nav">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Статистика</span>
                </a>
                <a href="#" class="nav-item" data-page="products">
                    <i class="fas fa-box"></i>
                    <span>Товары</span>
                </a>
                <a href="#" class="nav-item" data-page="orders">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Заказы</span>
                </a>
                <a href="#" class="nav-item" data-page="add-product">
                    <i class="fas fa-plus-circle"></i>
                    <span>Добавить товар</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <button class="btn-logout" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Выйти
                </button>
            </div>
        </aside>

        <!-- Основной контент -->
        <main class="admin-main">
            <!-- Хедер -->
            <header class="admin-header">
                <div class="header-left">
                    <h1 id="pageTitle">Статистика</h1>
                    <div class="last-updated">
                        <i class="fas fa-sync-alt"></i>
                        Обновлено: <span id="lastUpdated">только что</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="btn-refresh" id="refreshBtn">
                        <i class="fas fa-redo"></i> Обновить
                    </button>
                </div>
            </header>

            <!-- Контентные страницы -->
            <div class="admin-content">
                <!-- Статистика -->
                <div class="page active" id="dashboard">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon revenue">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalRevenue">0 ₽</h3>
                                <p>Общая выручка</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orders">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalOrders">0</h3>
                                <p>Всего заказов</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon products">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalProducts">0</h3>
                                <p>Всего товаров</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon pending">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="pendingOrders">0</h3>
                                <p>Ожидают обработки</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Управление товарами -->
                <div class="page" id="products">
                    <div class="products-header">
                        <h2>Управление товарами</h2>
                        <div class="products-actions">
                            <button class="btn btn-primary" id="addProductBtn">
                                <i class="fas fa-plus"></i> Добавить товар
                            </button>
                        </div>
                    </div>

                    <div class="products-table-container">
                        <table class="products-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Изображение</th>
                                    <th>Название</th>
                                    <th>Цена</th>
                                    <th>Остаток</th>
                                    <th>Категория</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <tr>
                                    <td colspan="7" class="loading-state">
                                        <i class="fas fa-spinner fa-spin"></i> Загрузка товаров...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Заказы -->
                <div class="page" id="orders">
                    <div class="orders-header">
                        <h2>Управление заказами</h2>
                    </div>
                    <div class="orders-table-container">
                        <table class="orders-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Пользователь</th>
                                    <th>Товары</th>
                                    <th>Сумма</th>
                                    <th>Статус</th>
                                    <th>Дата</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <tr>
                                    <td colspan="6" class="loading-state">
                                        <i class="fas fa-spinner fa-spin"></i> Загрузка заказов...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Добавление товара -->
                <div class="page" id="add-product">
                    <div class="add-product-header">
                        <h2>Добавить новый товар</h2>
                    </div>

                    <form class="add-product-form" id="addProductForm">
                        <!-- Основная информация -->
                        <div class="form-section">
                            <h3>Основная информация</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="productName">Название товара *</label>
                                    <input type="text" id="productName" required placeholder="Например: MacBook Air M2">
                                </div>
                                <div class="form-group">
                                    <label for="productPrice">Цена (₽) *</label>
                                    <input type="number" id="productPrice" step="0.01" required placeholder="129999">
                                </div>
                                <div class="form-group">
                                    <label for="productStock">Количество *</label>
                                    <input type="number" id="productStock" required placeholder="10">
                                </div>
                                <div class="form-group">
                                    <label for="productCategory">Категория</label>
                                    <select id="productCategory">
                                        <option value="">Выберите категорию</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Управление категориями -->
                        <div class="form-section">
                            <h3>Управление категориями</h3>
                            <div class="form-group">
                                <label>Добавить новую категорию</label>
                                <div class="category-input-group">
                                    <input type="text" id="newCategory" placeholder="Введите название">
                                    <button type="button" class="btn btn-primary" id="addCategoryBtn">
                                        <i class="fas fa-plus"></i> Добавить
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Существующие категории</label>
                                <div class="categories-list" id="categoriesList">
                                    <p class="loading-text">Загрузка категорий...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Описание -->
                        <div class="form-section">
                            <h3>Описание</h3>
                            <div class="form-group">
                                <label for="productDescription">Описание товара</label>
                                <textarea id="productDescription" rows="4" placeholder="Подробное описание товара..."></textarea>
                            </div>
                        </div>

                        <!-- Изображение товара -->
                        <div class="form-section">
                            <h3>Изображение товара</h3>
                            <div class="form-group">
                                <label for="productImageUrl">URL изображения</label>
                                <input type="url" id="productImageUrl"
                                       placeholder="https://example.com/image.jpg"
                                       value="https://via.placeholder.com/300x200">

                                <div class="upload-section">
                                    <p>Или загрузите изображение:</p>
                                    <div class="image-upload-area" id="imageUploadArea">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <p>Нажмите или перетащите изображение</p>
                                        <p class="upload-hint">PNG, JPG, GIF до 5MB</p>
                                    </div>
                                    <input type="file" id="imageFileInput" accept="image/*" class="file-input">
                                </div>

                                <div class="image-preview" id="imagePreview">
                                    <img src="https://via.placeholder.com/300x200" alt="Превью">
                                    <p>Изображение товара</p>
                                </div>
                            </div>
                        </div>

                        <!-- Кнопки действий -->
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelAdd">
                                Отмена
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Сохранить товар
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Упрощенный JavaScript - только самое необходимое
        let currentPage = 'dashboard';
        let products = [];
        let orders = [];

        // Функция переключения страниц
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            document.querySelector(`.nav-item[data-page="${pageId}"]`)?.classList.add('active');

            const titles = {
                'dashboard': 'Статистика',
                'products': 'Управление товарами',
                'orders': 'Заказы',
                'add-product': 'Добавить товар'
            };

            const titleElement = document.getElementById('pageTitle');
            if (titleElement && titles[pageId]) {
                titleElement.textContent = titles[pageId];
            }

            currentPage = pageId;
        }

        // Функция обновления времени
        function updateLastUpdated() {
            const element = document.getElementById('lastUpdated');
            if (element) {
                const now = new Date();
                element.textContent = now.toLocaleTimeString('ru-RU');
            }
        }

        // Функция уведомлений
        function showAlert(message, type = 'info') {
            const colors = {
                'success': '#2ecc71',
                'error': '#e74c3c',
                'info': '#3498db'
            };

            const alert = document.createElement('div');
            alert.textContent = message;
            alert.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 10px;
                background: ${colors[type] || '#3498db'};
                color: white;
                z-index: 10000;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                animation: fadeIn 0.3s ease;
                max-width: 400px;
                font-weight: 500;
            `;

            document.body.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            // Навигация
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    showPage(this.dataset.page);
                });
            });

            // Кнопка обновить
            document.getElementById('refreshBtn')?.addEventListener('click', () => {
                updateLastUpdated();
                showAlert('Данные обновлены', 'success');
            });

            // Кнопка выхода
            document.getElementById('logoutBtn')?.addEventListener('click', () => {
                if (confirm('Вы уверены, что хотите выйти?')) {
                    window.location.href = '/';
                }
            });

            // Кнопка добавления товара
            document.getElementById('addProductBtn')?.addEventListener('click', () => {
                showPage('add-product');
            });

            // Кнопка отмены
            document.getElementById('cancelAdd')?.addEventListener('click', () => {
                showPage('products');
            });

            // Превью изображения
            const imageUrlInput = document.getElementById('productImageUrl');
            const imagePreview = document.getElementById('imagePreview');

            if (imageUrlInput && imagePreview) {
                imageUrlInput.addEventListener('input', function() {
                    const img = imagePreview.querySelector('img');
                    if (img) {
                        img.src = this.value || 'https://via.placeholder.com/300x200';
                    }
                });
            }

            // Обновляем время
            updateLastUpdated();
        });
    </script>
</body>
</html>